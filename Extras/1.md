

## Tables

### `BRANCH`

```sql
CREATE TABLE BRANCH (
    BRANCH_ID INT PRIMARY KEY,
    BR_CITY VARCHAR(10)
);
```

### `CUSTOMER`

```sql
CREATE TABLE CUSTOMER (
    NAME VARCHAR(10) PRIMARY KEY,
    ADDRESS VARCHAR(10)
);
```

### `ACCOUNT`

```sql
CREATE TABLE ACCOUNT (
    NAME VARCHAR(10),
    A_NO INT PRIMARY KEY,
    BALANCE INT CHECK(BALANCE >= 500),
    BRANCH_ID INT,
    FOREIGN KEY(NAME) REFERENCES CUSTOMER(NAME),
    FOREIGN KEY(BRANCH_ID) REFERENCES BRANCH(BRANCH_ID)
);
```

## Trigger

### `L_ACC`
Ensures a customer can have no more than 3 accounts.

```sql
CREATE OR REPLACE TRIGGER L_ACC
BEFORE INSERT ON ACCOUNT
FOR EACH ROW
DECLARE 
    ACC_COUNT INT;
BEGIN
    SELECT COUNT(*) INTO ACC_COUNT FROM ACCOUNT WHERE NAME = :NEW.NAME;
    IF ACC_COUNT >= 3 THEN
       RAISE_APPLICATION_ERROR(-20001, 'A CUSTOMER CANNOT HAVE MORE THAN 3 ACCOUNTS');
    END IF;
END;
/
```

## Procedure

### `BRANCH_LIST`
Generates a report of total account balances per branch.

```sql
CREATE OR REPLACE PROCEDURE BRANCH_LIST AS
   CURSOR CUR IS 
      SELECT NAME, BALANCE, B.BRANCH_ID 
      FROM ACCOUNT A, BRANCH B 
      WHERE A.BRANCH_ID = B.BRANCH_ID 
      ORDER BY B.BRANCH_ID;
   BRANCH_ID BRANCH.BRANCH_ID%TYPE;
   NAME ACCOUNT.NAME%TYPE;
   BALANCE ACCOUNT.BALANCE%TYPE;
   OLD_BID BRANCH.BRANCH_ID%TYPE := NULL;
   TOTAL ACCOUNT.BALANCE%TYPE := 0;
BEGIN
   OPEN CUR;
   LOOP
      FETCH CUR INTO NAME, BALANCE, BRANCH_ID;
      EXIT WHEN CUR%NOTFOUND;
      IF BRANCH_ID != OLD_BID OR OLD_BID IS NULL THEN
         IF OLD_BID IS NOT NULL THEN
            DBMS_OUTPUT.PUT_LINE('TOTAL : ' || TOTAL);
         END IF;
         DBMS_OUTPUT.PUT_LINE('BRANCH : ' || BRANCH_ID);
         DBMS_OUTPUT.PUT_LINE('ACCOUNTS : ');
         TOTAL := 0;
      END IF;
      DBMS_OUTPUT.PUT_LINE('    ' || NAME);
      TOTAL := TOTAL + BALANCE;
      OLD_BID := BRANCH_ID;
   END LOOP;
   DBMS_OUTPUT.PUT_LINE('TOTAL : ' || TOTAL);
   CLOSE CUR;
END;
/
```

## Execute Procedure

```sql
EXECUTE BRANCH_LIST;
```

